<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>老墙根下，躲雨</title>
  <subtitle>A raindrop is one sea, one rainbow.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://zenvv.com/"/>
  <updated>2016-04-26T15:02:38.361Z</updated>
  <id>http://zenvv.com/</id>
  
  <author>
    <name>Peter Xu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>nginx和tomcat配置完美支持HTTPS</title>
    <link href="http://zenvv.com/2016/04/26/nginx-proxy-https-tomcat/"/>
    <id>http://zenvv.com/2016/04/26/nginx-proxy-https-tomcat/</id>
    <published>2016-04-26T14:07:00.000Z</published>
    <updated>2016-04-26T15:02:38.361Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;之前的几篇文章简单描述了nginx反向代理和tomcat之间的一些常用配置，满足一些常规需求。&lt;br&gt;但是，随着互联网安全隐患发生的频繁性，现如今安全性已经成为一个基本需求，而https则是其中的最基础平台之一。&lt;/p&gt;
&lt;p&gt;在nginx中启用ssl非常简单，只需要几句简单的配置和证书即可。当nginx和tomcat配合使用，其中nginx作为反向代理前端时，该如何实现https呢？&lt;/p&gt;
&lt;p&gt;第一种方法，即在nginx和tomcat中使用同样的证书，打开https功能。&lt;br&gt;nginx接受到用户请求进行解密进行处理，加密请求发送到tomcat；&lt;br&gt;tomcat节点接受到请求解密进行处理，对响应数据进行加密转发回到ningx；&lt;br&gt;最后，nginx需要解密tomcat的响应数据，再重新加密转发给客户端。&lt;/p&gt;
&lt;p&gt;可以看到，整个过程非常复杂，并且tomcat和nginx节点均需要加密解密多次。&lt;/p&gt;
&lt;p&gt;第二种方法，只需要在nginx前端启用ssl, nginx与后台tomcat之间的通信走http/1.0明文。&lt;br&gt;nginx接受用户请求进行解密处理，发送明文请求到tomcat;&lt;br&gt;tomcat对请求明文进行处理，返回响应数据的明文给ningx;&lt;br&gt;最后nginx对tomcat的响应数据加密转发到用户。&lt;/p&gt;
&lt;p&gt;需要注意在第二种方法中，默认tomcat返回的响应明文中的url link全部是http地址。&lt;br&gt;也即是说，用户的第一次请求(逻辑上的首次http get)可以正常返回，随后根据在该返回内容中的访问link都被拒绝，由于这些link（由相对地址转化而来，原本就是绝对url地址除外）都是http而不是https。&lt;/p&gt;
&lt;p&gt;对于这个问题，需要从两方面配置解决，首先在nginx前端代理请求到tomcat时需要附带上用户请求的协议名字schema（http或https）, 配置如下:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header Host $http_host;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header X-Real-Ip $remote_addr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header X-Forwarded-Proto  $scheme;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header Cookie $http_cookie;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_pass http://tomcat;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;X-Forwarded-Proto即是在http header请求中添加用户真实协议，而不是代理协议http.&lt;/p&gt;
&lt;p&gt;其次在tomcat中需要显示使用http head中该字段x-forwarded-proto, 配置如下:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;Valve className=&amp;quot;org.apache.catalina.valves.RemoteIpValve&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   remoteIpHeader=&amp;quot;x-forwarded-for&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   remoteIpProxiesHeader=&amp;quot;x-forwarded-by&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   protocolHeader=&amp;quot;x-forwarded-proto&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;tomcat的mod_remoteip模块将会根据protocolHeader字段和protocolHeaderHttpsValue值作如下逻辑判断：&lt;br&gt;如果protocolHeader对应字段的值与protocolHeaderHttpsValue(默认是https,可以设置)一致且是https，则root url是&lt;a href=&quot;https://ip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://ip&lt;/a&gt;;&lt;br&gt;否则采用&lt;a href=&quot;http://ip作为root&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://ip作为root&lt;/a&gt; url,不论用户真实请求的协议.  &lt;/p&gt;
&lt;p&gt;这样，nginx和tomcat搭配的https请求就可以工作了，但这仅仅适用于nginx和tomcat均处于内网中。&lt;/p&gt;
&lt;p&gt;在数据中心中，前端nginx一般位于DMZ区域拥有公网IP地址，而tomcat可能位于局域网中只有内网地址。这时我们会发现以上配置不起作用。&lt;br&gt;由于tomcat默认机制中需要判断代理服务器的IP地址，如果该IP地址是内网网段，则启用以上逻辑否则无效，而转而使用默认规则http处理。&lt;/p&gt;
&lt;p&gt;为了解决这个问题，需要将代理IP(例如a.b.c.d)添加到tomcat的允许区域中，可进行如下配置:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;Valve className=&amp;quot;org.apache.catalina.valves.RemoteIpValve&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   remoteIpHeader=&amp;quot;x-forwarded-for&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   remoteIpProxiesHeader=&amp;quot;x-forwarded-by&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   protocolHeader=&amp;quot;x-forwarded-proto&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   internalProxies=&amp;quot;a\.b\.c\.d&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;internalProxies将会覆盖tomcat的默认内网网段设置，这时通过公网ip可以正常访问https，但在内部直接连接tomcat则只能获取到首页内容，类似上面访问nginx的情形。&lt;br&gt;internalProxies支持正则表达式，可以在将nginx代理公网ip和内网网段全部添加进去即可，如下所示:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;internalProxies=&amp;quot;a\.b\.c\.d,10\.*,192\.168\.*&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;既然tomcat已经在数据中心内网中，可以有更简单的设置:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;Valve className=&amp;quot;org.apache.catalina.valves.RemoteIpValve&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   remoteIpHeader=&amp;quot;x-forwarded-for&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   remoteIpProxiesHeader=&amp;quot;x-forwarded-by&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   protocolHeader=&amp;quot;.*&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;如此，完美解决nginx + tomcat + https的问题。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;之前的几篇文章简单描述了n
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>DNS服务器dnsmasq</title>
    <link href="http://zenvv.com/2016/04/19/dnsmasq-by-talk/"/>
    <id>http://zenvv.com/2016/04/19/dnsmasq-by-talk/</id>
    <published>2016-04-18T16:41:00.000Z</published>
    <updated>2016-04-24T17:07:29.227Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;在构建数据中心网络时, 建立一个独立的dns服务是必不可少的.&lt;/p&gt;
&lt;p&gt;dns服务器有很多种, 如bind9/skydns等, 但是bind9显得笨重难以配置维护, skydns是不错的软件, 在多种分布式系统中被使用, 如google的k8s.&lt;/p&gt;
&lt;p&gt;这里介绍另一种简洁的dns服务软件 - dnsmasq, 配置简单如下所示.&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#listen-address=..&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;expand-hosts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;domain=example.com&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cache-size=300&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#no-resolv&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;domain-needed&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# for other servers(consul)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server=/consul./127.0.0.1#8600&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# for common domain&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;address=/ntp.io/10.10.10.9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;address=/dns.io/10.10.10.10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;listen-address默认不配置时则在所有ip地址监听.&lt;br&gt;expand-hosts和domain搭配使用, 自动将/etc/hosts中的名字扩展到example.com.&lt;br&gt;no-resolv不使用/etc/resolv.conf对域名解析.&lt;br&gt;domain-needed不转发没有格式的域名.&lt;br&gt;server=..用于某些域名转发到其它dns server, 在这个例子中将所有以.consul为后缀的域名, 转发到127.0.0.1:8600的dns服务器进行解析.&lt;br&gt;address=..用于定义本地网络的dns域名解析.  &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;在构建数据中心网络时, 建
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>系统监控及日志收集elk+beats</title>
    <link href="http://zenvv.com/2016/04/18/elk-beats-by-talk/"/>
    <id>http://zenvv.com/2016/04/18/elk-beats-by-talk/</id>
    <published>2016-04-18T15:13:00.000Z</published>
    <updated>2016-04-24T16:34:15.564Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;针对数据中心的监控, 许多公司积极响应并开源自己的方案, 传统的有nagios和zabbix等.&lt;/p&gt;
&lt;p&gt;当前比较流行的方案有flume/scribe/openfalcon/elk(beats), 这里将具体介绍下elk.&lt;/p&gt;
&lt;p&gt;最新官方建议使用轻量级的beats(golang)取代logstash作为客户端, beats收集数据发送到logstash broker或者直接发送到elasticsearch. &lt;/p&gt;
&lt;p&gt;笔者建议使用beats =&amp;gt; logstash =&amp;gt; elasticsearch =&amp;gt; kibana这种数据流, 利用logstash可以对数据作额外处理以及减少系统耦合性.  &lt;/p&gt;
&lt;h5 id=&quot;beats客户端&quot;&gt;&lt;a href=&quot;#beats客户端&quot; class=&quot;headerlink&quot; title=&quot;beats客户端&quot;&gt;&lt;/a&gt;beats客户端&lt;/h5&gt;&lt;p&gt;beats包含多种工具, 常用的有三种:&lt;br&gt;topbeat: 主要监控系统的cpu/memory/disk, 周期性的收集系统数据.&lt;br&gt;filebeat: 用于收集系统和应用程序日志, 发送日志到logstash作额外处理可以收集感兴趣的信息.&lt;br&gt;packetbeat: 用于嗅探系统网络信息(被动), 如http/mysql/等等.&lt;/p&gt;
&lt;p&gt;但是, topbeat中没有收集linux系统/proc/net基本信息的功能, 而是集成到packetbeat中显得稍笨重不方便使用.&lt;/p&gt;
&lt;h5 id=&quot;logstash&quot;&gt;&lt;a href=&quot;#logstash&quot; class=&quot;headerlink&quot; title=&quot;logstash&quot;&gt;&lt;/a&gt;logstash&lt;/h5&gt;&lt;p&gt;logstash起初是作为elk中的客户端, 但作为一个收集系统基本数据的工具, 而显得太笨重而一直被诟病.&lt;br&gt;尽管如此, logstash提供了许多插件功能极其丰富, 很适合作为broker节点.&lt;/p&gt;
&lt;p&gt;logstash的数据处理通常有三部分构成, 分别对应于三种插件:&lt;br&gt;(1) input插件, 获取数据, 比如监听端口或者从消息队列中订阅数据.&lt;br&gt;(2) filter插件, 对收集到的数据作进一步的处理, 例如解析ip地址为经纬度.&lt;br&gt;(3) output插件, 输出数据到其它服务中,如elasticsearch/kafka/zeromq.  &lt;/p&gt;
&lt;h5 id=&quot;elasticsearch&quot;&gt;&lt;a href=&quot;#elasticsearch&quot; class=&quot;headerlink&quot; title=&quot;elasticsearch&quot;&gt;&lt;/a&gt;elasticsearch&lt;/h5&gt;&lt;p&gt;终于回到正题了, elasticsearch是基于lucence引擎的一套简单高可用系统, 提供了非常方面的nosql/rest服务的功能, 也是这套监控系统的核心所在. &lt;/p&gt;
&lt;p&gt;最新版本的elasticsearch可以很方便建立一个分布式集群, 在该集群中通常有master和数据这两大类节点.&lt;/p&gt;
&lt;p&gt;(1) 节点属性&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cluster.name: es_cluster    # 集群名&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.name: $&amp;#123;HOSTNAME&amp;#125;		# 将hostname作为节点名字&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.master: true			# 节点是否可以被选作为master节点&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;node.data: true				# 节点是否可以被选作为data节点&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里注意, 如果node.master和node.data均为false, 则该节点是一个仲裁节点, 类似nginx负载均衡的功能.&lt;/p&gt;
&lt;p&gt;(2) 发现机制zen&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;discovery.zen.ping.multicast.enabled: false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;discovery.zen.ping_interval: 3s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;discovery.zen.ping_timeout: 30s&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;discovery.zen.ping_retries: 5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;discovery.zen.ping.unicast.hosts: &amp;quot;host1&amp;quot;, &amp;quot;host2:9300&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;采用unicast方式显示设置集群中的节点, 默认各个节点之间使用的端口是9300.&lt;/p&gt;
&lt;p&gt;(3) 配置网络&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# network&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;network.host: 0.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;network.bind_host: 0.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;network.publish_host: 0.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# http service&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;http.compression: true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;http.compression_level: 3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h5 id=&quot;kibana&quot;&gt;&lt;a href=&quot;#kibana&quot; class=&quot;headerlink&quot; title=&quot;kibana&quot;&gt;&lt;/a&gt;kibana&lt;/h5&gt;&lt;p&gt;收集数据是为了展现, kibana即是一种基于elasticsearch数据展现的工具.&lt;br&gt;kibana默认提供了topbeat/filebeat/packetbeat等的数据展示模版. &lt;/p&gt;
&lt;h5 id=&quot;elastalert&quot;&gt;&lt;a href=&quot;#elastalert&quot; class=&quot;headerlink&quot; title=&quot;elastalert&quot;&gt;&lt;/a&gt;elastalert&lt;/h5&gt;&lt;p&gt;作为一个监控系统, 报警机制不得缺少, elastic官方提供的收费方案比较简单.&lt;br&gt;这里介绍一种免费开源方案, 那就是&lt;a href=&quot;https://github.com/Yelp/elastalert.git&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;elastalert&lt;/a&gt;, 具体参考官方代码.&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;针对数据中心的监控, 许多
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Rexify运维工具</title>
    <link href="http://zenvv.com/2016/04/16/rexify-ansible-by-talk/"/>
    <id>http://zenvv.com/2016/04/16/rexify-ansible-by-talk/</id>
    <published>2016-04-16T01:33:00.000Z</published>
    <updated>2016-04-24T16:34:42.051Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;当系统达到一定规模时，传统单机器维护方式已经不再适合，需要一些自动化工具进行管理。&lt;/p&gt;
&lt;p&gt;下面将介绍在实践工程中使用的几种方式(针对单一类型系统: linux)。&lt;/p&gt;
&lt;h4 id=&quot;1-ssh&quot;&gt;&lt;a href=&quot;#1-ssh&quot; class=&quot;headerlink&quot; title=&quot;1. ssh&quot;&gt;&lt;/a&gt;1. ssh&lt;/h4&gt;&lt;p&gt;ssh工具一款linux及其类系统中的利器，常被用来作远程系统登录和数据拷贝，同时还有另外一个重要功能: 远程执行命令。&lt;/p&gt;
&lt;p&gt;同时，针对一些小规模的系统(例如几十个节点)，ssh也拥有足够的能力对其自动化管理。&lt;/p&gt;
&lt;p&gt;在配置完成ssh的无密码key连接方式之后，编写一些bash脚本管理远程主机地址即可。当然，纯ssh工具对管理人员的要求比较高。&lt;/p&gt;
&lt;p&gt;可以考虑采用一些第三方工具简化管理，常见工具如puppet, chef, cfengine, ansible以及rexify等。&lt;/p&gt;
&lt;p&gt;使用过其中的两款ansible和rexify, 均属于灵巧型-无客户端和服务端，非常适合喜欢干净系统的工程师(最烦在各个子节点上安装agent)，也是在ssh的基础上实现的。&lt;/p&gt;
&lt;h4 id=&quot;2-ansible&quot;&gt;&lt;a href=&quot;#2-ansible&quot; class=&quot;headerlink&quot; title=&quot;2. ansible&quot;&gt;&lt;/a&gt;2. ansible&lt;/h4&gt;&lt;p&gt;ansible是python语言开发的一种框架，基于yaml语法和提供的模块定义各种playbook，对软件进行配置管理，并且能够支持windows(powershell)。&lt;/p&gt;
&lt;p&gt;ansible对于常规的运维管理已经足够，如果需要支持复杂的定制化服务，则需要编写playbook甚至新模块来支持。&lt;/p&gt;
&lt;p&gt;不得不说，编写playbook也是一个繁琐的过程，其功能常显得鸡肋以及力不从心(如在nosql中作join查询)。&lt;/p&gt;
&lt;p&gt;可以通过编写新模块或者脚本对其扩展，ansible新模块的方式不是很方便。&lt;br&gt;而编写脚本然后远程执行相对简单，但也常遇到一些不可思议的错误。&lt;/p&gt;
&lt;h4 id=&quot;3-rexify&quot;&gt;&lt;a href=&quot;#3-rexify&quot; class=&quot;headerlink&quot; title=&quot;3. rexify&quot;&gt;&lt;/a&gt;3. rexify&lt;/h4&gt;&lt;p&gt;rexify是perl语言开发的框架，目标即是无客户端轻量级，与ansible不同的是其完全基于模块的方式进行远程管理，充分利用了perl语言的优点。&lt;/p&gt;
&lt;p&gt;rexify模块提供的功能足够丰富，在此基础上进行一些整合，即可轻易地支持所需要的功能。同时也对脚本的远程执行支持非常好。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;当系统达到一定规模时，传统
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Nginx虚拟主机和多域名处理逻辑</title>
    <link href="http://zenvv.com/2016/04/13/nginx-server-config/"/>
    <id>http://zenvv.com/2016/04/13/nginx-server-config/</id>
    <published>2016-04-13T12:30:00.000Z</published>
    <updated>2016-04-15T13:19:52.118Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;与apache httpd类似，在nginx中通过server字段定义多个虚拟主机。&lt;br&gt;nginx按照server加载顺序处理用户请求, 但可能导致一些意外行为，下面将进行具体描述。&lt;/p&gt;
&lt;p&gt;假设服务器地址为ServerIP, 该IP被多个域名映射(www.b.com, www.c.com和www.d.com).&lt;/p&gt;
&lt;h4 id=&quot;情形1：所有server在同一个文件中-例如default-conf&quot;&gt;&lt;a href=&quot;#情形1：所有server在同一个文件中-例如default-conf&quot; class=&quot;headerlink&quot; title=&quot;情形1：所有server在同一个文件中, 例如default.conf.&quot;&gt;&lt;/a&gt;情形1：所有server在同一个文件中, 例如default.conf.&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# server-b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name b.com www.b.com;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# server-c&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name c.com www.c.com;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;显然b.com/c.com将会分别正确访问到server-b/server-c的资源,&lt;/p&gt;
&lt;p&gt;d.com/ServerIP也可以访问到nginx, 由于没有匹配的server_name，&lt;br&gt;nginx按照server加载顺序进行处理，将使用第一个server资源进行响应请求。&lt;br&gt;于是d.com访问的是server-b的资源。&lt;/p&gt;
&lt;h5 id=&quot;1-禁止d-com&quot;&gt;&lt;a href=&quot;#1-禁止d-com&quot; class=&quot;headerlink&quot; title=&quot;1) 禁止d.com&quot;&gt;&lt;/a&gt;1) 禁止d.com&lt;/h5&gt;&lt;p&gt;如果仅禁止d.com访问server-b/c的资源，可以显示定义server处理d.com。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# server-b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name b.com www.b.com;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# server-c&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name c.com www.c.com;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# server-d&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name d.com www.d.com;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    	try_files $uri $uri/ =404;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h5 id=&quot;2-同时禁止d-com和ServerIP&quot;&gt;&lt;a href=&quot;#2-同时禁止d-com和ServerIP&quot; class=&quot;headerlink&quot; title=&quot;2) 同时禁止d.com和ServerIP&quot;&gt;&lt;/a&gt;2) 同时禁止d.com和ServerIP&lt;/h5&gt;&lt;p&gt;如果同时禁止d.com和ServerIP访问资源(server-b/server-c), 则需在server-b之再定义一个空server虚拟主机。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# server-non&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name _;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		try_files $uri $uri/ =404;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# server-b&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name b.com www.b.com;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# server-c&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name c.com www.c.com;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;对于server-non设置中的server-name值无所谓，只要不影响正常服务即可。&lt;/p&gt;
&lt;p&gt;显然，第二种设置更简单通用，但需要在所有虚拟主机之前定义空server才起作用。&lt;/p&gt;
&lt;h4 id=&quot;情形2-server在不同的文件中&quot;&gt;&lt;a href=&quot;#情形2-server在不同的文件中&quot; class=&quot;headerlink&quot; title=&quot;情形2: server在不同的文件中&quot;&gt;&lt;/a&gt;情形2: server在不同的文件中&lt;/h4&gt;&lt;p&gt;假设b.com设置在bsize.conf中，c.com设置在csite.conf中. b/c.com均能正常访问资源。&lt;br&gt;但d.com/ServerIP仍然是访问server-b的资源，而不是server-c，原因是由于Nginx include是按照文件名字ascii属性进行加载的。&lt;/p&gt;
&lt;p&gt;也即是说，bsite.conf中server比csite.conf优先加载, 如果c.com设置在bsite.conf,b.com设置在csite.conf，则d.com/ServerIP访问到的是server-c的资源。&lt;/p&gt;
&lt;p&gt;因此，对于仅禁止d.com访问server-b/server-c的资源，仅需要显示设置其即可(文件名无所谓)，如下所示。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# server-d&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name d.com www.d.com;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		try_files $uri $uri/ =404;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;如果需要通用禁止所有非b.com/c.com(如d.com/ServerIP)访问资源，则必须设置比已有配置文件名ascii更靠前的文件名。在这个案例中，创建一个文件名为aaa.conf即可，其内容如下&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# server-non&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name _;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		try_files $uri $uri/ =404;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;与apache httpd
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>HTTP URI末尾斜杠在nginx中的处理</title>
    <link href="http://zenvv.com/2016/04/11/nginx-slash-http/"/>
    <id>http://zenvv.com/2016/04/11/nginx-slash-http/</id>
    <published>2016-04-11T09:39:00.000Z</published>
    <updated>2016-04-15T13:20:51.611Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;HTTP协议请求的uri, 是以斜杠”/“(slash)作为基本分割符。而对于末尾的斜杠容易被我们忽略，下面将就这个问题进行具体分析。&lt;/p&gt;
&lt;p&gt;首先得明确，http uri是否以slash结尾，是意味着不同的含义，例如以slash分割后的最后一个单元字段命名为lastsection。那么通常情况下，不是以slash结尾是指向服务器请求名字为lastsection的资源(&lt;code&gt;http://localhost/lastsection&lt;/code&gt;)，以slash结尾的是请求路径lastsection下的某个资源(&lt;code&gt;http://localhost/lastsection/&lt;/code&gt;)。&lt;/p&gt;
&lt;p&gt;具体到nginx中，又是如何进行处理的，下面以静态资源为例，并将index设置为index.html。&lt;/p&gt;
&lt;p&gt;&lt;b&gt;情形1: nginx root下不存在test目录&lt;/b&gt;&lt;br&gt;如果请求&lt;code&gt;http://localhost/test&lt;/code&gt;, 则nginx返回错误(404 Not Found)。&lt;/p&gt;
&lt;p&gt;&lt;b&gt;情形2: root下存在test空目录&lt;/b&gt;&lt;br&gt;如果请求&lt;code&gt;http://localhost/test&lt;/code&gt;, 则nginx返回(301 Moved Permanently), 浏览器在收到后，将重新请求(Redirect) &lt;code&gt;http://localhost/test/&lt;/code&gt;, 由于test为空目录不存在index.html, 故而nginx返回错误(403 Forbidden)。&lt;/p&gt;
&lt;p&gt;如果请求&lt;code&gt;http://localhost/test/&lt;/code&gt;, 则nginx直接返回错误(403 Forbidden)。&lt;/p&gt;
&lt;p&gt;&lt;b&gt;情形3: test目录中存在文件index.html&lt;/b&gt;&lt;br&gt;如果请求&lt;code&gt;http://localhost/test&lt;/code&gt;, 则nginx返回(301 Moved Permanently), 浏览器在收到后，将重定向到(Redirect) &lt;code&gt;http://localhost/test/&lt;/code&gt;, nginx返回(200 OK)。&lt;/p&gt;
&lt;p&gt;如果请求&lt;code&gt;http://localhost/test/&lt;/code&gt;, 则nginx直接返回(200 OK)。&lt;/p&gt;
&lt;p&gt;注意，当在浏览器中重复请求同一个有效资源时，Nginx将返回(304 Not Modified)而不是(200 OK)。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;如上所述，nginx对这些末尾没有slash而相应目录下不存在相应资源的请求，将会返回301致使客户端尝试带有slash重新redirect请求一次。在使用nginx作为反向代理(如tomcat)时，也会发生相关未预料的行为。同时这种行为也导致客户端重复请求一次。&lt;/p&gt;
&lt;p&gt;在实际部署中通过rewrite模块等方式可以避免这种情况。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;HTTP协议请求的uri,
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Nginx反向代理的压缩设置和日志格式</title>
    <link href="http://zenvv.com/2016/04/09/nginx-proxy-config/"/>
    <id>http://zenvv.com/2016/04/09/nginx-proxy-config/</id>
    <published>2016-04-09T13:29:00.000Z</published>
    <updated>2016-04-15T13:37:46.542Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;使用Nginx作反向代理时，在实际部署中对代理压缩和日志格式作一些调整，以提高性能和便于后续的数据处理。&lt;/p&gt;
&lt;p&gt;在之前一篇&lt;a href=&quot;http://zenvv.com/2016/04/06/nginx-tomcat-config/&quot;&gt;《nginx配置和tomcat会话保持》&lt;/a&gt;的基础上作一些总结和加强。&lt;/p&gt;
&lt;h4 id=&quot;1-反向代理压缩&quot;&gt;&lt;a href=&quot;#1-反向代理压缩&quot; class=&quot;headerlink&quot; title=&quot;1. 反向代理压缩&quot;&gt;&lt;/a&gt;1. 反向代理压缩&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;http &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    gzip  on;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    gzip_disable &amp;quot;msie6&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    gzip_vary on;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    gzip_proxied any;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    gzip_min_length 1k;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    gzip_comp_level 3;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    gzip_buffers 16 8k;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    gzip_http_version 1.0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    gzip_types text/plain text/css application/json application/x-javascript application/javascript text/javascript application/xml;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果被代理的服务器已经打开gzip, 则此处建议关闭&lt;code&gt;gzip_proxied off;&lt;/code&gt;。&lt;/p&gt;
&lt;h4 id=&quot;2-反向代理日志格式&quot;&gt;&lt;a href=&quot;#2-反向代理日志格式&quot; class=&quot;headerlink&quot; title=&quot;2. 反向代理日志格式&quot;&gt;&lt;/a&gt;2. 反向代理日志格式&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;http &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    log_format access &amp;apos;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; $http_host &amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;apos;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;apos;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot; &amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;apos;$upstream_addr $upstream_status $upstream_cache_status &amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;apos;&amp;quot;$upstream_http_content_type&amp;quot; $upstream_response_time &amp;gt; $request_time&amp;apos;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name vhost;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	access_log /var/log/nginx/access_vhost.log access;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;设置目的是记录用户地址和处理服务器地址，便于作数据分析和系统监控。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;使用Nginx作反向代理时
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Python发展与我</title>
    <link href="http://zenvv.com/2016/04/07/python-in-practice/"/>
    <id>http://zenvv.com/2016/04/07/python-in-practice/</id>
    <published>2016-04-07T14:15:00.000Z</published>
    <updated>2016-04-14T03:53:04.418Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;Python具有简洁易用等优点，是我所最喜爱的语言之一，至今为止已断断续续使用了快十年之久。&lt;/p&gt;
&lt;h4 id=&quot;1-Python简史&quot;&gt;&lt;a href=&quot;#1-Python简史&quot; class=&quot;headerlink&quot; title=&quot;1. Python简史&quot;&gt;&lt;/a&gt;1. Python简史&lt;/h4&gt;&lt;p&gt;Guido从1989年的圣诞节期间开始，到1991年的第一个python编译器发布，已经是二十多年的编程语言，从语言发展史来看算是一个老语言了。&lt;br&gt;但如今依然表现为青春主流，活力不减，仍没有可取代的语言。&lt;/p&gt;
&lt;p&gt;这里简单吐槽下python的强制格式对齐，许多人对这种要求非常不满甚至痛恨。&lt;/p&gt;
&lt;p&gt;私下以为，如果知道大名鼎鼎的perl, 并用其编写过若干应用，一定会对Python的格式对齐大呼过瘾，^_^。&lt;/p&gt;
&lt;h4 id=&quot;2-Python大发展&quot;&gt;&lt;a href=&quot;#2-Python大发展&quot; class=&quot;headerlink&quot; title=&quot;2. Python大发展&quot;&gt;&lt;/a&gt;2. Python大发展&lt;/h4&gt;&lt;p&gt;在Python仍是一种小众语言的时候，即开始基于python编写一些具体的应用和数据处理模块，如P2P应用、增量爬虫、门户网站和数据统计等。&lt;/p&gt;
&lt;p&gt;对现有的各种解决方案进行综合集成，使用python进行处理，其带来的快感让人欲罢不能。&lt;/p&gt;
&lt;p&gt;随后在cisco的那几年工作期间中并没有其相关的需求，平时用来编写一些系统小工具作为消遣(后来直接使用bash)。&lt;/p&gt;
&lt;p&gt;在这段时间内，python却有了巨大的发展变化，成为主流语言之一。&lt;/p&gt;
&lt;p&gt;python的发展离不开其开放架构， 如twisted/django/web.py/flask/pip/virtualenv等的蓬勃兴起，极大地推动了python语言的普及和发展。&lt;/p&gt;
&lt;p&gt;同时，python凭借其优秀的语言特性，在数据分析领域逐渐占据了统治地位，成为了名副其实的Number one。&lt;/p&gt;
&lt;p&gt;今天，Python在各处活动并作用着，从最直接的web服务，大数据分析，人工智能，系统监控运维，甚至到最基础操作系统的正常运行，都有其并不伟岸的身影。&lt;/p&gt;
&lt;p&gt;毫不夸张的说，Python在支撑着这个时代最伟大的互联网，是互联网时代伟大的基石之一。&lt;/p&gt;
&lt;h4 id=&quot;3-Python适合场景&quot;&gt;&lt;a href=&quot;#3-Python适合场景&quot; class=&quot;headerlink&quot; title=&quot;3. Python适合场景&quot;&gt;&lt;/a&gt;3. Python适合场景&lt;/h4&gt;&lt;p&gt;Python通过一种非常简洁的方式来解决实际需求，从而引领互联网的大势。&lt;/p&gt;
&lt;p&gt;然而，Python并不是万能的，其语言特点决定了应用场景，那即是I/O密集型和非实时的应用。&lt;/p&gt;
&lt;p&gt;Python最不适合的情景是处理实时的CPU密集型任务，这里将不会就语言的具体实现进行分析。&lt;/p&gt;
&lt;p&gt;一句不恰当的总结，python适合周期内执行代码少的应用(即耗用cpu周期少)。&lt;/p&gt;
&lt;p&gt;对于大多数的web应用，系统瓶颈主要在于各种I/O性能，例如网络带宽和磁盘读写速度。&lt;/p&gt;
&lt;p&gt;而对于数据分析领域，通常进行离线处理数据，而不是提供实时数据分析返回结果。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;爱好一种语言可以，不要盲从。&lt;br&gt;世上没有一蹴而就，没有万能。&lt;br&gt;让每一种语言，做适合的任务。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;Python具有简洁易用等
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="python" scheme="http://zenvv.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Tomcat常用配置</title>
    <link href="http://zenvv.com/2016/04/07/tomcat-config/"/>
    <id>http://zenvv.com/2016/04/07/tomcat-config/</id>
    <published>2016-04-07T13:22:00.000Z</published>
    <updated>2016-04-14T03:38:05.515Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;tomcat默认配置已能满足正常需求，为了优化服务可以进行以下的简单设置。&lt;/p&gt;
&lt;p&gt;以下配置针对tomcat8。&lt;/p&gt;
&lt;h4 id=&quot;1-设置Connector-server-xml&quot;&gt;&lt;a href=&quot;#1-设置Connector-server-xml&quot; class=&quot;headerlink&quot; title=&quot;1. 设置Connector(server.xml)&quot;&gt;&lt;/a&gt;1. 设置Connector(server.xml)&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;Connector port=&amp;quot;8080&amp;quot; protocol=&amp;quot;HTTP/1.1&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           connectionTimeout=&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           acceptCount=&amp;quot;1024&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           maxThreads=&amp;quot;1024&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           minSpareThreads=&amp;quot;16&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           acceptorThreadCount=&amp;quot;4&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           URIEncoding=&amp;quot;UTF-8&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           useURIValidationHack=&amp;quot;false&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           enableLookups=&amp;quot;false&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           compression=&amp;quot;on&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           compressionMinSize=&amp;quot;2048&amp;quot; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           compressableMimeType=&amp;quot;text/html,text/xml,text/javascript,text/css,text/plain&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           redirectPort=&amp;quot;8443&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;acceptCount: 等待处理队列的最大长度，超过该数目的后续请求将被refuse&lt;br&gt;maxThreads: 处理任务的最大线程数，即同时能够处理的最大任务数目&lt;br&gt;minSpareThreads: 保留的最少空闲线程数&lt;br&gt;acceptorThreadCount: 接受连接(socket accept调用)的线程数，默认为1，通常设置为cpu核心数&lt;br&gt;protocol=”HTTP/1.1”: java http connector协议。&lt;/p&gt;
&lt;p&gt;tomcat8标准连接器包括BIO阻塞模式，非阻塞NIO1，非阻塞NIO2和ARP/Native四种模式。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;protocol=&amp;quot;org.apache.coyote.http11.Http11Protocol&amp;quot; - blocking Java connector&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;protocol=&amp;quot;org.apache.coyote.http11.Http11NioProtocol&amp;quot; - non blocking Java NIO connector&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;protocol=&amp;quot;org.apache.coyote.http11.Http11Nio2Protocol&amp;quot; - non blocking Java NIO2 connector&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;protocol=&amp;quot;org.apache.coyote.http11.Http11AprProtocol&amp;quot; - the APR/native connector.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;当使用protocol=”HTTP/1.1”时，如果PATH(windows)或LD_LIBRARY_PATH(linux)路径下，存在tomcat native库，则使用APR/native模式；否选使用一种NIO模式。&lt;br&gt;实际部署中，建议设置protocol=”HTTP/1.1”。&lt;/p&gt;
&lt;p&gt;各个模式具体说明见&lt;a href=&quot;http://tomcat.apache.org/tomcat-8.0-doc/config/http.html#Connector_Comparison&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官方链接&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;这里主要调整acceptCount/maxThreads这几个参数，提高并发处理能力，同时对文本文件进行压缩(compression=on)。&lt;/p&gt;
&lt;h4 id=&quot;2-nginx前端-tomcat后端的配置&quot;&gt;&lt;a href=&quot;#2-nginx前端-tomcat后端的配置&quot; class=&quot;headerlink&quot; title=&quot;2. nginx前端+tomcat后端的配置&quot;&gt;&lt;/a&gt;2. nginx前端+tomcat后端的配置&lt;/h4&gt;&lt;p&gt;首先, nginx作为反向代理前端，需要设置将用户信息传送到tomcat。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header Host $http_host;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header X-Real-Ip $remote_addr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header X-Forwarded-Proto  $scheme;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header Cookie $http_cookie;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_pass http://tomcat;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;其次，tomcat将这些真实用户信息写到日志中(默认是代理nginx的信息)(server.xml)。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;Host name=&amp;quot;localhost&amp;quot;  appBase=&amp;quot;webapps&amp;quot; unpackWARs=&amp;quot;true&amp;quot; autoDeploy=&amp;quot;true&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;Valve className=&amp;quot;org.apache.catalina.valves.RemoteIpValve&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     remoteIpHeader=&amp;quot;x-forwarded-for&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     remoteIpProxiesHeader=&amp;quot;x-forwarded-by&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     protocolHeader=&amp;quot;x-forwarded-proto&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;Context path=&amp;quot;/&amp;quot; docBase=&amp;quot;&amp;quot; debug=&amp;quot;0&amp;quot; privileged=&amp;quot;true&amp;quot; reloadable=&amp;quot;false&amp;quot;/&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;Valve className=&amp;quot;org.apache.catalina.valves.AccessLogValve&amp;quot; directory=&amp;quot;logs&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         prefix=&amp;quot;localhost_access_log&amp;quot; suffix=&amp;quot;.txt&amp;quot; resolveHosts=&amp;quot;false&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         pattern=&amp;quot;%h %l %u %t &amp;amp;quot;%r&amp;amp;quot; %s %b %&amp;#123;x-forwarded-for&amp;#125;i&amp;quot; /&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/Host&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里存在另一个细节，在产品部署中建议设置reloadable=”false”以提高tomcat性能。&lt;/p&gt;
&lt;h4 id=&quot;3-tomcat启动设置&quot;&gt;&lt;a href=&quot;#3-tomcat启动设置&quot; class=&quot;headerlink&quot; title=&quot;3. tomcat启动设置&quot;&gt;&lt;/a&gt;3. tomcat启动设置&lt;/h4&gt;&lt;p&gt;tomcat使用的是java默认参数，实际部署中可以根据系统的具体性能进行调整，如下所示将其添加到tomcat的启动脚本catalina.sh和daemon.sh中。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;JAVA_OPTS=&amp;quot;-server&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-Xms512M -Xmx4096M&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-XX:LargePageSizeInBytes=128m&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-XX:+AggressiveOpts&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-XX:+UseBiasedLocking&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-XX:+DisableExplicitGC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-XX:+UseFastAccessorMethods&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-XX:+UseParNewGC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-XX:+UseConcMarkSweepGC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-XX:+CMSParallelRemarkEnabled&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-XX:+UseCMSCompactAtFullCollection&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-XX:+UseCMSInitiatingOccupancyOnly&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-Djava.awt.headless=true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-Djava.security.egd=file:/dev/./urandom&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;-Xms: 初始化内存&lt;br&gt;-Xmx: 最大内存&lt;br&gt;-Xss: 线程栈大小，无需设置&lt;br&gt;-XX:+AggressiveOpts: JVM性能优化，加快编译&lt;br&gt;-XX:+UseBiasedLocking: JVM lock优化&lt;br&gt;-XX:LargePageSizeInBytes=128m: 堆的内存页大小&lt;br&gt;-XX:+DisableExplicitGC: 关闭系统System.gc()&lt;br&gt;-Djava.awt.headless=true: headless模式，适于server程序，无鼠标/显示/键盘等。&lt;br&gt;-Djava.security.egd=file:/dev/./urandom: 默认/dev/random是block模式，针对大并发有性能影响，若对随机数要求不高则用伪随机代替(使用file:/dev/./urandom,不是file:/dev/urandom)。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;更多的优化服务设置，请参照&lt;a href=&quot;http://tomcat.apache.org/tomcat-8.0-doc/config/http.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官方文档&lt;/a&gt;。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;tomcat默认配置已能满
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>nginx配置和tomcat会话保持</title>
    <link href="http://zenvv.com/2016/04/06/nginx-tomcat-config/"/>
    <id>http://zenvv.com/2016/04/06/nginx-tomcat-config/</id>
    <published>2016-04-06T15:37:00.000Z</published>
    <updated>2016-04-14T03:39:35.941Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;使用nginx提供web服务，除了配置简单以外，主要有以下两个优点：a. 高并发处理能力; b. 负载均衡。&lt;/p&gt;
&lt;h4 id=&quot;1-高性能设置&quot;&gt;&lt;a href=&quot;#1-高性能设置&quot; class=&quot;headerlink&quot; title=&quot;1. 高性能设置&quot;&gt;&lt;/a&gt;1. 高性能设置&lt;/h4&gt;&lt;p&gt;对于高并发处理能力，通常进行如下配置。&lt;br&gt;a. linux内核配置&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[/etc/sysctl.d/60-kernel.conf]:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# net.core&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.core.wmem_default=8388608&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.core.rmem_default=8388608&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.core.rmem_max=16777216&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.core.wmem_max=16777216&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.core.netdev_max_backlog=262144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.core.somaxconn=65535&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# net.ipv4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.ip_forward=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.conf.default.rp_filter=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.conf.all.rp_filter=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.conf.default.accept_source_route=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.ip_local_port_range=10240 65000&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# net.ipv4.tcp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_sack=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_window_scaling=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_rmem=4096 87380 16777216&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_wmem=4096 65536 16777216&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_max_orphans=262144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_timestamps=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_mem=1543458 2057947 3086916&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_fin_timeout=15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_keepalive_time=300&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_syncookies=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_max_syn_backlog=262144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_syn_retries=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_synack_retries=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_tw_reuse=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_tw_recycle=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.ipv4.tcp_max_tw_buckets=262144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[/etc/security/limits.d/nofile.conf]:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;*               hard    nofile            65535 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;*               soft    nofile            65535&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;b. nginx并发配置&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;worker_processes 8; 		# cpu core num&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;worker_rlimit_nofile 65535; # nofile.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;events &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    use epoll;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    worker_connections 20480;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;2-负载均衡&quot;&gt;&lt;a href=&quot;#2-负载均衡&quot; class=&quot;headerlink&quot; title=&quot;2. 负载均衡&quot;&gt;&lt;/a&gt;2. 负载均衡&lt;/h4&gt;&lt;p&gt;nginx常被作为应用服务前端的反向代理服务器，很容易提供负载均衡能力，即通过proxy_pass和upstream语法实现，如下所示。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;upstream servers &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    server host1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    server host2;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在该配置下，nginx按rr(round-robin)轮询模式，将用户请求分发到不同的server上进行处理，从而达到负载均衡的效果。轮询模式非常适合那些无状态的应用服务。&lt;/p&gt;
&lt;p&gt;但是，如果针对有状态的应用服务如tomcat(即需要保持session)，轮询模式不能够保证同一用户的访问请求，总是被映射到同一台tomcat服务器上，从而导致不能正确处理同一个用户的请求，例如，用户在tomcat1上登录，然而后续的请求被发送到tomcat2上，tomcat2并不能验证该用户是否已经登录从而要求用户重新登录。&lt;/p&gt;
&lt;p&gt;常见的解决方法，是通过nginx内建的ip_hash模式，保证同一个用户的请求始终被同一个tomcat所处理，如下所示。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;upstream servers &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ip_hash;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    server tomcat1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    server tomcat2;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然而，ip_hash不能够提供高质量的负载均衡能力。&lt;/p&gt;
&lt;p&gt;为了让tomcat能够处理用户的session会话，常见的几种解决办法有:&lt;br&gt;a. 建立tomcat集群共享session，任意一个tomcat均能够处理集群内其他tomcat所产生的session。&lt;br&gt;b. 建立key/value服务(如redis/memcached)，让nginx和应用程序在这个服务中维护session达到共享的目的。&lt;br&gt;但是，这两种解决办法增加了系统架构的复杂度，增添了潜在风险，如tomcat集群/kv服务的稳定性。&lt;/p&gt;
&lt;p&gt;这里，还有一种比较简洁的，也是重点推荐的一种解决办法。通过将第三方模块sticky(nginx-sticky-module-ng)编译进nginx中，然后进行如下配置:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;upstream servers &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sticky path=/app_cookie_path;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    server tomcat1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    server tomcat2;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;sticky模块的实现原理如下:&lt;br&gt;a. 对upstream下的所有server进行hash标识(即每一个server有一个hash值)；&lt;br&gt;b. 对用户请求按rr模式分配一个server，并将该server的hash值添加到用户cookie的route属性中；&lt;br&gt;c. 对用户的随后请求，通过其cookie中的route属性值，映射到同一个tomcat服务器中进行处理。&lt;br&gt;从而保证同一个用户的请求，始终被分配到同一个tomcat中进行处理。&lt;/p&gt;
&lt;p&gt;&lt;b&gt;在sticky模块使用过程中，需要注意一个问题: 建议显示设置sticky的path值，即应用程序的cookie标识。&lt;/b&gt;&lt;/p&gt;
&lt;p&gt;官方文档path值为可选且默认为”/“，这是非常误导的，并且在国内网上的各种博客中都没有设置，大伙在测试demo时测试正确然后就没有下文。&lt;/p&gt;
&lt;p&gt;正如前面sticky实现原理中所说的，sticky是通过对应用程序的cookie设置route值实现的。  &lt;/p&gt;
&lt;p&gt;而在实际产品部署中，常见的是nginx同时配置多个应用，而每个应用都会有自己的cookie标识，而不是默认的”/“，这样导致nginx所设置的cookie route值在用户随后的访问中不起作用。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;使用nginx提供web服
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="nginx" scheme="http://zenvv.com/tags/nginx/"/>
    
      <category term="tomcat" scheme="http://zenvv.com/tags/tomcat/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://zenvv.com/2016/04/05/hello-world/"/>
    <id>http://zenvv.com/2016/04/05/hello-world/</id>
    <published>2016-04-04T16:30:00.000Z</published>
    <updated>2016-04-14T03:38:47.468Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;font size=&quot;1&quot;&gt;&lt;b&gt;[声明] 再次重建个人blog, 许多博文已丢失，幸好还能从一些被转载的文章中找回几篇。再附上一篇转帖共勉：&lt;/b&gt;&lt;/font&gt;


&lt;p&gt;有人说过：有一句说一百句的是文学家，这叫文采；有一句说十句的是教授，这叫学问；有一句说一句的是律师，这叫谨慎；说一句留一句的是外交家，这叫严谨；有十句说一句的是政治家，这叫心计；有点事甚至半句也没有的人，却发微博，这叫啥好呢？自己想吧。&lt;br&gt;&lt;b&gt;[想不到见本篇标题，^_^]&lt;/b&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;font size=&quot;1&quot;&gt;&lt;
    
    </summary>
    
      <category term="杂谈" scheme="http://zenvv.com/categories/%E6%9D%82%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>童年的清明</title>
    <link href="http://zenvv.com/2016/04/04/qingming-2016/"/>
    <id>http://zenvv.com/2016/04/04/qingming-2016/</id>
    <published>2016-04-04T11:45:00.000Z</published>
    <updated>2016-04-06T14:03:54.898Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;清明时节雨纷纷，路上行人欲断魂。&lt;/p&gt;
&lt;p&gt;又一年清明时节，伴雨而来，随风而去。&lt;/p&gt;
&lt;p&gt;小时候的清明，每次，家族的几个小伙伴们都兴高采烈，因为有几个小节目等着我们去实现，一年又一年的重复着，乐此不彼。&lt;/p&gt;
&lt;p&gt;刚入山不久，很快将遇到我们的第一个节目。映山红，初中时从课本里才知道也叫作杜鹃，杜鹃啼血，美丽的鲜艳。农历三月左右，山里的映山红，大部分还没有动静，小伙伴们争先恐后的寻找着最盛开的一片，划归到自己的名下。然后摘选一些最美丽的花朵随手拿着并吃着，有股淡淡的甜味，同时挖几颗造型酷的花丛带回家种植。&lt;/p&gt;
&lt;p&gt;随着山路的左转右拐，到达了一大群刺杉群林，此起彼伏，对儿时的我们来说好不阴森，深怕一不留神陷进去走丢了。但令人想不到的是，就是在这些扎人的刺杉丛林里，一大堆不知什么名字的蕨类植物的幼芽正破土而出，鲜嫩带有点涩苦味，摘回去用地道的香油清炒，特别的有味道。&lt;/p&gt;
&lt;p&gt;最后，在刺杉林的最深处，进行繁杂的祭祖活动。&lt;br&gt;随着活动的结束，我们不约而同想最高处的山顶登去，那里有着一块神秘的大石块。&lt;/p&gt;
&lt;p&gt;相传，二郎真君驾云空中，发现此处有一大石块于是准备休息下。腾云而下一屁股直坐到那块大石头上，没成想石头太软(这里的山石大多是石灰岩)没能撑住真君，直向下凹陷而去。真君发现腚部下陷，于是随手用神戟在旁边撑住，随身一跃，腾空而起，双脚站到刚才屁股所在的地方。虽然站立起来，石头依然撑不住双脚继续下陷，这下一个不稳，我们的二郎真君直往旁边的下坡倒下，一头撞到大石块的下半部分。真君显然没想到在这个地方栽了一跤，丢不起那人，四周打探一下连忙腾空而走(忘了还有土地神)。&lt;/p&gt;
&lt;p&gt;与许多人不一样，高中时候的我开始住校，每学期回家的次数平均一到两次。老家位于一个较为偏僻的地区，交通不发达，再加上非常的晕车，回家是个奢侈。&lt;br&gt;高中的前两年，每次，我们坐着汽车，汽车乘着轮渡，游过那条不宽的大河，到达那个穿山而过的小镇。等桥连通的那一年，正好赶上高三的下学期，繁忙的学业没有给丝毫喘息的机会周末回家。&lt;/p&gt;
&lt;p&gt;人生第一次离开了每年清明必去山里祭祖的春游。到如今已经十几年，原本计划今年能赶回家，恰这时候赶上感冒，又没能回去，再度走一下儿时的路。&lt;/p&gt;
&lt;p&gt;此时此刻，只能感叹下，许多东西都在改变，不变的只有儿时的记忆。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;清明时节雨纷纷，路上行人欲
    
    </summary>
    
      <category term="杂谈" scheme="http://zenvv.com/categories/%E6%9D%82%E8%B0%88/"/>
    
    
  </entry>
  
  <entry>
    <title>WebRtc 网络基本流程</title>
    <link href="http://zenvv.com/2014/12/10/webrtc-by-talk/"/>
    <id>http://zenvv.com/2014/12/10/webrtc-by-talk/</id>
    <published>2014-12-10T04:12:00.000Z</published>
    <updated>2016-04-17T03:06:45.423Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;WebRtc是一款非常优秀的实时音视频通信框架，采用RFC方案SDP offer/answer的方式建立网络会话。&lt;/p&gt;
&lt;h3 id=&quot;1-发起Setup-Call&quot;&gt;&lt;a href=&quot;#1-发起Setup-Call&quot; class=&quot;headerlink&quot; title=&quot;1. 发起Setup Call&quot;&gt;&lt;/a&gt;1. 发起Setup Call&lt;/h3&gt;&lt;p&gt;1).call and create local&lt;/p&gt;
&lt;p&gt;CreatePeerConnection()&lt;br&gt;GetUserMedia() =&amp;gt; AddLocalStream()/SetLocalRender()    &lt;/p&gt;
&lt;p&gt;2).send offer&lt;/p&gt;
&lt;p&gt;createOffer() =&amp;gt; SetLocalSdp(offer) =&amp;gt; SendOffer()     &lt;/p&gt;
&lt;p&gt;3).recv answer&lt;/p&gt;
&lt;p&gt;RecvAnswer() =&amp;gt; SetRemoteSdp(answer)&lt;br&gt;OnRemoteStream()  =&amp;gt; SetRemoteRender()&lt;/p&gt;
&lt;h3 id=&quot;2-应答Answer-Call&quot;&gt;&lt;a href=&quot;#2-应答Answer-Call&quot; class=&quot;headerlink&quot; title=&quot;2. 应答Answer Call&quot;&gt;&lt;/a&gt;2. 应答Answer Call&lt;/h3&gt;&lt;p&gt;1).recv call&lt;/p&gt;
&lt;p&gt;CreatePeerConnection()  &lt;/p&gt;
&lt;p&gt;2).recv offer&lt;/p&gt;
&lt;p&gt;RecvOffer() =&amp;gt; SetRemoteSdp()&lt;br&gt;GetUserMedia() =&amp;gt; AddLocalStream()/SetLocalRender()   &lt;/p&gt;
&lt;p&gt;3).send answer&lt;/p&gt;
&lt;p&gt;createAnswer() =&amp;gt; SetLocalSdp(answer) =&amp;gt; SendAnswer()&lt;br&gt;OnRemoteStream()  =&amp;gt; SetRemoteRender()  &lt;/p&gt;
&lt;h3 id=&quot;3-stun网络&quot;&gt;&lt;a href=&quot;#3-stun网络&quot; class=&quot;headerlink&quot; title=&quot;3. stun网络&quot;&gt;&lt;/a&gt;3. stun网络&lt;/h3&gt;&lt;p&gt;下面将就网络的基本类型作简单描述，以便理解stun的作用，假设内网主机I:i, 防火墙F:f, 外网主机S1:s1和S2:s2.&lt;/p&gt;
&lt;p&gt;1) full cone:  I:i &amp;lt;=&amp;gt; F:f, 任意外网主机均可通过F:f发给I:i&lt;/p&gt;
&lt;p&gt;2) restricted cone: I:i &amp;lt;=&amp;gt; F:f &amp;lt;=&amp;gt; S1, I:i &amp;lt;=&amp;gt; F:f &amp;lt;=&amp;gt; S2, 只有S1和S2可以通过F:f发给I:i&lt;/p&gt;
&lt;p&gt;3) port restricted cone:  I:i &amp;lt;=&amp;gt; F:f &amp;lt;=&amp;gt; S1:s1, I:i &amp;lt;=&amp;gt; F:f &amp;lt;=&amp;gt; S2:s2, 只有S1:s1和S2:s2可以通过F:f发数据给I:i&lt;/p&gt;
&lt;p&gt;4) symmetric NAT: I:i &amp;lt;=&amp;gt; F:f1 &amp;lt;=&amp;gt; S1:s1, I:i &amp;lt;=&amp;gt; F:f2 &amp;lt;=&amp;gt; S2:s2&lt;/p&gt;
&lt;p&gt;基本处理流程如下(来着mozilla):&lt;br&gt;&lt;img src=&quot;https://mdn.mozillademos.org/files/6119/webrtc-complete-diagram.png&quot; alt=&quot;STUN/TURN in WebRTC&quot;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;相关webrtc源代码封装库和浏览器插件实现，可以参照&lt;a href=&quot;https://github.com/peterxu/librtc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;librtc&lt;/a&gt;和&lt;a href=&quot;https://github.com/peterxu/RTCHub&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;RTCHub&lt;/a&gt;。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;WebRtc是一款非常优秀
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Linux编译安装Darwin Streaming Server 6.0.3</title>
    <link href="http://zenvv.com/2009/10/04/Linux-dss-6-0-3/"/>
    <id>http://zenvv.com/2009/10/04/Linux-dss-6-0-3/</id>
    <published>2009-10-04T15:22:00.000Z</published>
    <updated>2016-04-07T14:11:50.361Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;font size=&quot;1&quot; color=&quot;grey&quot;&gt;&lt;br&gt;[声明] 很久前在chinaunix hi中分享了几篇blog, 由于其意外关闭导致全部丢失。如今，意外的发现有几篇被很多人引用，其中一些博主们并没有声明转载！在此重建个人博客以正声明，同时感谢那些博主们，否则找不回这篇旧文。&lt;br&gt;&lt;/font&gt;

&lt;h3 id=&quot;1、什么是Darwin-Streaming-Server&quot;&gt;&lt;a href=&quot;#1、什么是Darwin-Streaming-Server&quot; class=&quot;headerlink&quot; title=&quot;1、什么是Darwin Streaming Server&quot;&gt;&lt;/a&gt;1、什么是Darwin Streaming Server&lt;/h3&gt;&lt;p&gt;目前主流的流媒体服务器有微软的windows media server、RealNetworks的Helixserver和苹果公司的Darwin Streaming Server. 微软的windows media server只能在windows2000 server和windows 2003 server下使用，不在考虑之列。RealNetworks的Helixserver是一款跨平台的软件，功能也很强大，但并非免费软件。&lt;/p&gt;
&lt;p&gt;Darwin Streaming Server简称DSS。DSS是Apple公司提供的开源实时流媒体播放服务器程序。整个程序使用C++编写，在设计上遵循高性能，简单，模块化等程序设计原则，务求做到程序高效，可扩充性好。并且DSS是一个开放源代码的，基于标准的流媒体服务器，可以运行在Windows NT和Windows 2000，以及几个UNIX实现上，包括Mac OS X，Linux，FreeBSD，和Solaris操作系统上的。&lt;/p&gt;
&lt;h3 id=&quot;2、在Linux中编译安装Darwin-Streaming-Server&quot;&gt;&lt;a href=&quot;#2、在Linux中编译安装Darwin-Streaming-Server&quot; class=&quot;headerlink&quot; title=&quot;2、在Linux中编译安装Darwin Streaming Server&quot;&gt;&lt;/a&gt;2、在Linux中编译安装Darwin Streaming Server&lt;/h3&gt;&lt;p&gt;首先需要进行一些必要的准备工作：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;apt-get install patch make gcc g++&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;准备好软件暂存的目录，并从官网下载软件的源码：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mkdir soft&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd soft&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget http://dss.macosforge.org/downloads/DarwinStreamingSrvr6.0.3-Source.tar&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;源码下载完成后，需要解压tar包，&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tar xvf DarwinStreamingSrvr6.0.3-Source.tar&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;给源码安装补丁文件，进入DarwinStreamingSrvr6.0.3-Source目录，并打补丁：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd DarwinStreamingSrvr6.0.3-Source&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wget http://www.abrahamsson.com/dss-6.0.3.patch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;patch -p1 &amp;lt; dss-6.0.3.patch&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;执行&lt;code&gt;./Buildit&lt;/code&gt;编译完成后，我们来生成linux下的dss安装包.  &lt;/p&gt;
&lt;p&gt;执行&lt;code&gt;./buildtarball&lt;/code&gt;生成DarwinStreamingSrvr-Linux.tar.gz&lt;/p&gt;
&lt;p&gt;然后解压缩&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf DarwinStreamingSrvr-Linux.tar.gz &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd DarwinStreamingSrvr-Linux&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;对Install文件做修改&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;if [ $INSTALL_OS = &amp;quot;Linux&amp;quot; ]; then &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /usr/sbin/useradd -M qtss &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;else &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /usr/sbin/useradd qtss &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fi&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;将-M修改成-m&lt;/p&gt;
&lt;p&gt;执行&lt;code&gt;./Install&lt;/code&gt;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Please enter a new administrator user name: 【新管理员】  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Please enter a new administrator Password: 【密码】&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;查看是否安裝成功&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ps aux | grep Darwin(查看流媒体服务器的进程)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root ... ... ... /usr/local/sbin/DarwinStreamingServer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;qtss ... ... ... /usr/local/sbin/DarwinStreamingServer&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;netstat -ntulp | grep Darwin(查看流媒体服务器的端口)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;3-启动Server提供服务&quot;&gt;&lt;a href=&quot;#3-启动Server提供服务&quot; class=&quot;headerlink&quot; title=&quot;3. 启动Server提供服务&quot;&gt;&lt;/a&gt;3. 启动Server提供服务&lt;/h3&gt;&lt;p&gt;启动 Darwin Streaming Server&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo /usr/local/sbin/DarwinStreamingServer&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;启动 Web 管理介面 (tcp port 1220)&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo /usr/local/sbin/streamingadminserver.pl&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;ps. 以上两项在刚安装好的时候会自动启动，不需手动执行&lt;br&gt;ps. 自动启动流媒体服务器的方法：&lt;br&gt;自动运行流媒体服务器序非常简单，把上述命令添加在/etc/rc.d/rc.local脚本中即可。&lt;/p&gt;
&lt;p&gt;最后在服务器输入 &lt;code&gt;&lt;a href=&quot;http://你的IP:1220/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://你的IP:1220/&lt;/a&gt;&lt;/code&gt;来访问web管理&lt;br&gt;默认的媒体文件存放在&lt;code&gt;/usr/local/movies&lt;/code&gt;&lt;br&gt;你可以在web管理面板修改这个路径。&lt;/p&gt;
&lt;h3 id=&quot;4、访问自己的流媒体服务&quot;&gt;&lt;a href=&quot;#4、访问自己的流媒体服务&quot; class=&quot;headerlink&quot; title=&quot;4、访问自己的流媒体服务&quot;&gt;&lt;/a&gt;4、访问自己的流媒体服务&lt;/h3&gt;&lt;p&gt;可以使用VLC media player这个软件，输入&lt;code&gt;rtsp://你的IP/sample_100kbit.mp4&lt;/code&gt;来播放默认的测试视频。如果你的网速够给力的话效果还不错 ：)&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;font size=&quot;1&quot; c
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>在Debian下安装mythtv</title>
    <link href="http://zenvv.com/2009/05/12/debian-install-mythtv/"/>
    <id>http://zenvv.com/2009/05/12/debian-install-mythtv/</id>
    <published>2009-05-12T14:23:00.000Z</published>
    <updated>2016-04-14T03:41:26.165Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;在debian中安装配置mythtv环境。&lt;/p&gt;
&lt;p&gt;一. 环境配置&lt;br&gt;如果是debian或ubuntu系统，可以直接通过以下命令来安装mythtv；&lt;/p&gt;
&lt;p&gt;对于debian或ubuntu系统，首先选择源:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;打开/etc/apt/sources.list文件，添加源：（国内）&lt;br&gt;deb &lt;a href=&quot;http://debian.ustc.edu.cn/debian&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://debian.ustc.edu.cn/debian&lt;/a&gt; lenny main&lt;br&gt;deb &lt;a href=&quot;http://debian.ustc.edu.cn/debian&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://debian.ustc.edu.cn/debian&lt;/a&gt; lenny main contrib&lt;br&gt;deb &lt;a href=&quot;http://debian.ustc.edu.cn/debian&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://debian.ustc.edu.cn/debian&lt;/a&gt; lenny main non-free&lt;br&gt;deb &lt;a href=&quot;http://www.debian-multimedia.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.debian-multimedia.org&lt;/a&gt; lenny main&lt;br&gt;或者：（国外）&lt;br&gt;deb &lt;a href=&quot;http://ftp.debian.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://ftp.debian.org/&lt;/a&gt; lenny main&lt;br&gt;deb &lt;a href=&quot;http://ftp.debian.org/debian&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://ftp.debian.org/debian&lt;/a&gt; lenny main contrib&lt;br&gt;deb &lt;a href=&quot;http://ftp.debian.org/debian&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://ftp.debian.org/debian&lt;/a&gt; lenny main non-free&lt;br&gt;deb &lt;a href=&quot;http://www.debian-multimedia.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.debian-multimedia.org&lt;/a&gt; lenny main&lt;br&gt;如果以上源都无法连上，可以找其他国内源&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;添加完保存退出后，使用sudo apt-get update命令更新上面的源，然后开始mythtv的安装&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;二. 安装使用mythtv  &lt;/p&gt;
&lt;p&gt;第一步：mythtv安装&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Sound安装&lt;br&gt; 1) aptitute install alsa-base alsa-utils libesd-alsa0&lt;br&gt; 2) 配置声卡命令：alsaconf&lt;/li&gt;
&lt;li&gt;引入gpg keys&lt;br&gt;命令：aptitute install debian-multimedia-keyring&lt;/li&gt;
&lt;li&gt;安装mythtv&lt;br&gt;1) aptitute install mythtv&lt;br&gt;2) mythtv安装过程配置mysql数据库(该数据库可以提前安装:aptitute install mysql-server),该数据库需要在root用户下进入：命令mysql -uroot -p&lt;br&gt;４. 安装mythtv其他组件，如mythvideo, mythmusic,mythphoto等&lt;br&gt;命令：aptitute install 组件名&lt;br&gt;然后重启mythtv，使用mythfrontend命令  &lt;/li&gt;
&lt;li&gt;配置mythtv，可以参考：&lt;a href=&quot;http://parker1.co.uk/mythtv_ubuntu.php，其中大部分都选择默认方式，需要最好选择英文，如果选hanzi的话就是繁体中文。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://parker1.co.uk/mythtv_ubuntu.php，其中大部分都选择默认方式，需要最好选择英文，如果选hanzi的话就是繁体中文。&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;第二步：播放本地视频文件  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用mythfrontend命令启动mythtv&lt;/li&gt;
&lt;li&gt;选择Utilities/Setup-&amp;gt;Setup-&amp;gt;Media Settings-&amp;gt;Videos Settings-&amp;gt;General Settings，在Directories that hold videos:一栏输入本地视频存放路径，然后保存设置。返回上一级，进入File Types，在Extension中选择播放的视频后缀，对于想播放的视频文件，其Use default player和Ignore项空起来，而在Command项如果mythtv自身可以播放就会出现Internal，如果为空，就可以输入系统中安装的播放器，如mplayer等。&lt;/li&gt;
&lt;li&gt;通过选择Utilities/Setup-&amp;gt;Video Manager可以看到视频目录中存在的文件&lt;/li&gt;
&lt;li&gt;返回最上层，选择Media Library-&amp;gt;Watch Videos，就可以看到可以播放的视频文件，任意选择一个，按Enter键显示该文件信息，再次Enter键就可以看到播放内容了&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;第三步：播放流媒体文件&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用aptitute install mythstream来安装mythstream组件&lt;/li&gt;
&lt;li&gt;安装完后就可以使用流媒体功能了，可以尝试mythstream组件中已有的流媒体文件&lt;/li&gt;
&lt;li&gt;使用sudo mythfrontend命令（注意前面使用了sudo）启动mythtv，进入Media Library-&amp;gt;Play online streams后，就可以选择里面的流媒体文件进行播放（需要能够连接国外网站）&lt;/li&gt;
&lt;/ol&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;在debian中安装配置m
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Shell批处理编码转换gbk-&gt;utf8</title>
    <link href="http://zenvv.com/2009/03/24/shell-gbk-to-utf8/"/>
    <id>http://zenvv.com/2009/03/24/shell-gbk-to-utf8/</id>
    <published>2009-03-24T07:59:00.000Z</published>
    <updated>2016-04-04T09:05:18.923Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;最近遇到工程里面c/c++代码注释utf8和gbk共存的情况,在服务器上使用vim编辑非常不方便.于是编写了一个shell程序遍历所有文件，并将所有文件中中文gbk编码转化为utf8。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#!/bin/sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 定义一个方法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;foreachd()&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  	# 遍历参数1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  	for file in $1/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  	do&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        # 如果是目录就打印处理，然后继续遍历，递归调用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if [ -d $file ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            # echo $file&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            foreachd $file&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            if [[ $file =~ &amp;quot;.h&amp;quot; || $file =~ &amp;quot;.cpp&amp;quot; ]]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                echo $file&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                tempfile=`echo $file”.5″`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                iconv -f gbk -t utf8 $file &amp;gt; $tempfile&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                mv $tempfile $file&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            fi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        fi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    done&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#执行，如果有参数就遍历指定的目录，否则遍历当前目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if [ $# -gt 0 ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;then&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    foreachd “$1″&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    foreachd “.”&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fi&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exit 0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;最近遇到工程里面c/c++
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Latex (wiki) 空格处理</title>
    <link href="http://zenvv.com/2009/03/11/latex-space/"/>
    <id>http://zenvv.com/2009/03/11/latex-space/</id>
    <published>2009-03-11T11:30:00.000Z</published>
    <updated>2016-04-04T09:09:52.723Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;注意TeX能够自动处理大多数的空格，但是您有时候需要自己来控制。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;功能　　　		　语法　　　	　显示　　　　　　备注 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;两个quad空格　　　a \qquad b	　a \qquad b　　两个m的宽度&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;quad空格　　　　　a \quad b	 　a \quad b　　一个m的宽度&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;大空格　　　　　　a\ b　　　　　　a\ b　　　　　1/3m宽度&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;中等空格　　　　　a\;b　　　　　　a\;b　　　　　2/7m宽度&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;小空格　　　　　　a\,b　　　　　　a\,b　　　　　1/6m宽度&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;没有空格　　　　　ab　　　　　　　ab\,	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;紧贴　　　　　　　a\!b　　　　　　a\!b　　　　　缩进1/6m宽度&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;注意TeX能够自动处理大多
    
    </summary>
    
      <category term="其他" scheme="http://zenvv.com/categories/%E5%85%B6%E4%BB%96/"/>
    
    
  </entry>
  
  <entry>
    <title>修改版通用Makefile模板</title>
    <link href="http://zenvv.com/2009/03/09/general-makefile/"/>
    <id>http://zenvv.com/2009/03/09/general-makefile/</id>
    <published>2009-03-09T08:15:00.000Z</published>
    <updated>2016-04-04T09:05:53.233Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;对一个已有的通用Makefile模板(来自whyglinux)作了部分修改，供自己使用。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;###############################################################################&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Generic Makefile for C/C++ Program&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Author: whyglinux (whyglinux AT hotmail DOT com)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Date: 2006/03/04&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Modified: uskee@hotmail.com at 2009/03/09&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Description:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The makefile searches in directories for the source files&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# with extensions specified in , then compiles the sources&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# and finally produces the , the executable file, by linking&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# the objectives.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Usage:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# $ make compile and link the program.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# $ make objs compile only (no linking. Rarely used).&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# $ make clean clean the objectives and dependencies.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# $ make cleanall clean the objectives, dependencies and executable.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# $ make rebuild rebuild the program. The same as make clean &amp;amp;&amp;amp; make all.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#==============================================================================&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;## Customizing Section: adjust the following if necessary.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;##=============================================================================&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The generated file name.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# It must be specified.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# PROGRAM := a.out # the generated name&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;PROGRAM :=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The directories in which source files reside.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# At least one path should be specified.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# SRCDIRS := . # current directory&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SRCDIRS := .&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The source file types (headers excluded).&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# At least one type should be specified.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The valid suffixes are among of .c, .C, .cc, .cpp, .CPP, .c++, .cp, or .cxx.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# SRCEXTS := .c # C program&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# SRCEXTS := .cpp # C++ program&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# SRCEXTS := .c .cpp # C/C++ program&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SRCEXTS := .c .cpp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The flags used by the cpp (man cpp for more).&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# CPPFLAGS := -Wall -Werror # show all warnings and take them as errors&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CPPFLAGS := -Wall -Werror -Wno-deprecated&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The compiling flags used only for C.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# If it is a C++ program, no need to set these flags.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# If it is a C and C++ merging program, set these flags for the C parts.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CFLAGS :=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CFLAGS +=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The compiling flags used only for C++.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# If it is a C program, no need to set these flags.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# If it is a C and C++ merging program, set these flags for the C++ parts.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CXXFLAGS :=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CXXFLAGS +=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The directories contains all required headers; “-I”&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;INCLUDES :=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;INCLUDES +=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The library and the link options ( C and C++ common).: “-L” and “-l”&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# If for generating dynamic libraries, using “-shared” option, or no.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LDFLAGS :=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LDFLAGS +=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#==============================================================================&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;## Implict Section: change the following only when necessary.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;##=============================================================================&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The C program compiler. Uncomment it to specify yours explicitly.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CC = gcc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The C++ program compiler. Uncomment it to specify yours explicitly.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CXX = g++&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Uncomment the 2 lines to compile C programs as C++ ones.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#CC = $(CXX)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#CFLAGS = $(CXXFLAGS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The command used to generate static library&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;AR	= ar rcs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# The command used to delete file.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RM	= rm -f&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#==============================================================================&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;## Stable Section: usually no need to be changed. But you can add more.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;##=============================================================================&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SHELL = /bin/sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SOURCES = $(foreach d,$(SRCDIRS),$(wildcard $(addprefix $(d)/*,$(SRCEXTS))))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OBJS = $(foreach x,$(SRCEXTS), \&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(patsubst %$(x),%.o,$(filter %$(x),$(SOURCES))))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DEPS = $(patsubst %.o,%.d,$(OBJS))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;.PHONY : all objs clean cleanall rebuild&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#—————————————————&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Rules for creating the dependency files (.d).&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#—————————————————&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;all : $(PROGRAM)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%.d : %.c&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@$(CC) -MM -MD $(CFLAGS) $(INCLUDES) $&amp;lt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%.d : %.cc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@$(CC) -MM -MD $(CXXFLAGS) $(INCLUDES) $&amp;lt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%.d : %.cpp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@$(CC) -MM -MD $(CXXFLAGS) $(INCLUDES) $&amp;lt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#---------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Rules for producing the objects.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#---------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;objs : $(OBJS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%.o : %.c&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(CC) -c $(CPPFLAGS) $(CFLAGS) $(INCLUDES) $&amp;lt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%.o : %.cc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $(INCLUDES) $&amp;lt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;%.o : %.cpp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $(INCLUDES) $&amp;lt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#---------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Rules for producing the executable.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#----------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(PROGRAM) : $(OBJS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# This is for generating executal program or dynamic library&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ifeq ($(strip $(SRCEXTS)), &amp;quot;.c&amp;quot;) # C file&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(CC) -o $(PROGRAM) $(OBJS) $(LDFLAGS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;else # C++ file&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(CXX) -o $(PROGRAM) $(OBJS) $(LDFLAGS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;endif&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# This is for generation static libraries.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# $(AR)	$(PROGRAM)	$(OBJS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-include $(DEPS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rebuild: clean all&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;clean :&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@$(RM) *.o *.d&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cleanall: clean&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;@$(RM) $(PROGRAM) $(PROGRAM).a $(PROGRAM).so&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### End of the Makefile ## Suggestions are welcome ## All rights reserved ###&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;###############################################################################&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;对一个已有的通用Makef
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>debian 5.0安装及配置</title>
    <link href="http://zenvv.com/2009/03/03/use-debian-5-0/"/>
    <id>http://zenvv.com/2009/03/03/use-debian-5-0/</id>
    <published>2009-03-03T08:53:00.000Z</published>
    <updated>2016-04-04T13:00:08.887Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;下面将就debian lenny 5.0在我本子上的具体安装及相关配置作些介绍，以作备份之用。&lt;/p&gt;
&lt;p&gt;debian lenny 5.0的启动速度约为10s, 关机速度为5s，比上一个版本确实升级了许多。之前我是从debian etch 4.0 r2升级到5.0，速度较慢(启动20s，关机10-15s)，升级之后gnome经常崩溃以及klog重启，实在经受不了于是昨天整修了下系统，但不小心将splashy给删除了，结果导致系统的许多服务启动不了, 不想将相关修补程序copy到系统下，于是重装了事省心。&lt;/p&gt;
&lt;h2 id=&quot;1-安装debian-lenny-5-0&quot;&gt;&lt;a href=&quot;#1-安装debian-lenny-5-0&quot; class=&quot;headerlink&quot; title=&quot;1. 安装debian lenny 5.0&quot;&gt;&lt;/a&gt;1. 安装debian lenny 5.0&lt;/h2&gt;&lt;p&gt;从debian.org官方网站上下载lenny 5.0的cd-image-1即可, 将其刻录成光盘。&lt;br&gt;开始进行安装，区域选择中国，语言选择中文，键盘选择US(一般)，其它默认即可，直到硬盘分区，默认自动分区没有问题，但建议手动分区：&lt;br&gt;(1)设置主分区，&lt;br&gt;(2)设置swap分区，&lt;br&gt;(3)单独分一块作为/home分区(这样能防止系统崩溃时数据不会丢失)。&lt;br&gt;然后开始copy并install系统。整个过程大约30-40分钟。&lt;br&gt;安装完毕后重新启动进入debian X系统，进行如下配置可以更加友好地使用系统。&lt;/p&gt;
&lt;h2 id=&quot;2-相关配置&quot;&gt;&lt;a href=&quot;#2-相关配置&quot; class=&quot;headerlink&quot; title=&quot;2. 相关配置&quot;&gt;&lt;/a&gt;2. 相关配置&lt;/h2&gt;&lt;p&gt;(1). 首先将当前帐户设置为sudo用户，先使用root登录，然后执行visudo, 仿照root插入新的一行，具体如下(假设当前用户为test)&lt;br&gt;$su -&lt;br&gt;密码:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#visudo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# /etc/sudoers&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# This file MUST be edited with the &amp;apos;visudo&amp;apos; command as root.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# See the man page for details on how to write a sudoers file.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Defaults env_reset&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Host alias specification&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# User alias specification&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# Cmnd alias specification&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# User privilege specification&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;root ALL=(ALL) ALL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 下面这个是你要添加的&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;test ALL=(ALL) ALL&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#exit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;logout&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;至此你的用户即为sudo用户，可以使用sudo + command执行root权限所能执行的东西。&lt;/p&gt;
&lt;p&gt;(2) 配置apt源&lt;br&gt;编辑/etc/apt/source.list文件，将以下几行加入到其中，并建议将其中cd源那几行注释掉。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;deb http://ftp.debian.org/ lenny main&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;deb http://ftp.debian.org/debian lenny main contrib&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;deb http://ftp.debian.org/debian lenny main non-free&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;deb http://www.debian-multimedia.org lenny main&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;后面的那个多媒体源需要去其网站上下载key并安装即可。然后执行&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ aptitude update&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;(3)安装相关软件&lt;br&gt;debian 5.0默认已经安装好ice-weasel(即是firefox的debian名称)，还需要安装的有以下几个：  &lt;/p&gt;
&lt;p&gt;工具类&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install scim scim-chinese scim-pinyin ##安装中文输入法，fcitx也挺好用的&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install unrar unzip ## 用来解压rar和.zip之类的压缩文件的&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install pidgin ## 可以用来登录msn, qq等聊天工具&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install lftp gftp ## lftp是比较好用的shell ftp工具，gftp是GUI工具&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install qterm ## 用来上bbs的term&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;娱乐类&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install vlc ##安装vlc播放器&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install mplayer smplayer ##安装mplayer播放器，其中smplayer是比较好用的mplayer界面&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install w32codecs ##安装mplayer相关解码器，可以支持rmvb等多种格式播放&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install wine ##安装windows程序模拟器wine,可以用来玩魔兽，CS等游戏&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;办公类&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install icedove ## 这是邮件客户端mozilla-thunderbird的debian名称。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install openoffice.org ##安装办公套装openoffice&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install stardict ## 安装英汉词典，另外有个qt版本qstardict，感兴趣的可以试试；词典库需要另外下载&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;开发类&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install vim ##将vim升级安装，会更加好用，当然需要配置下文件/etc/vim/vimrc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install emacs ## 喜欢用emacs可以安装这个编辑器&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install sun-java6-bin sun-java6-jre sun-java6-jdk ## 安装java库&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install eclipse ## 安装eclipse开发工具&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install manpages manpages-dev manpages-posix manpages-posix-dev ## 安装gcc开发文档&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;## 另外std c++文档直接用aptitude安装后不能使用，需要先下载该文档。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$aptitude download libstdc++6-4.3-doc&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;## 再解压缩该包将里面man下的文档，copy到/usr/share/man1下面，然后执行&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$mandb ## 该命令更新man手册文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;## 对于其它的手册不能使用的均可以采取上述方法。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;添加新字体&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$sudo mkdir /usr/local/share/fonts/simsung&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;将windows下的simsung.ttf文件&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo cp simsung.ttf /usr/local/share/fonts/simsung&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo fc-cache&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;然后即可在“外观首选项”中的“字体”项里面找到宋体和新宋体了。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;删除方法如下：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo rm -r /usr/local/share/fonts/simsung&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo fc-cache&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;修正debian时间&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;修改/etc/timezone文件和/etc/localtime文件:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo echo &amp;quot;Asia/Shanghai&amp;quot; &amp;gt; /etc/timezone&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;并将文件/etc/default/rcS中的UTC值改为no&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;通过网络校正本地时间&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install ntpdate&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo ntpdate pool.ntp.org&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;然后将时间更新到BIOS里面&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo hwclock --systohc&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;其它&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install virtualbox ## 比较好用的一款虚拟机，可以玩玩windows xp/vista/7等&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$sudo aptitude install freemind ## 随时记录自己的奇思妙想&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;下面将就debian le
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>sed使用之感想</title>
    <link href="http://zenvv.com/2008/12/17/sed-usage-feel/"/>
    <id>http://zenvv.com/2008/12/17/sed-usage-feel/</id>
    <published>2008-12-17T08:49:00.000Z</published>
    <updated>2016-04-04T13:04:12.607Z</updated>
    
    <content type="html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;最近处理大批量的html视频信息网页，从中提取视频图片url、播放url、主演、导演和简介等。不想写代码，于是直接使用shell下sed命令。&lt;/p&gt;
&lt;p&gt;sed的正则表达式确实很复杂(类perl的)，花了半个小时才搞定了。但看起来确实很爽，一行就搞定了.&lt;br&gt;下面这个命令是用于预处理信息的：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;find /tmp/mov_html | xargs cat | sed -n ’s/\(.*&amp;lt;dd&amp;gt;.*\”character_.*\)\|\(.*\”list_.*\)\|\(.*leiyancontent.*div\&amp;gt;\).*/\1\2\3\n/p’ &amp;gt; ./temp_mov_info.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;但运行起来确实痛苦，一直占CPU 90%以上，一共运行了近6个小时才完毕。即使通过xargs限制进程数和每次传入参数个数也不管用。&lt;br&gt;一方面是html中只有一小块信息是有效的，而这里是处理文件的所有行，浪费资源；另一方面，正则表达式写的不够完善，匹配很花时间，若在python程序中通过简单的find即可找到需要的块，然后再使用正则表达式匹配即可。&lt;br&gt;基于这两点，之后使用python程序改写了，效率大大提高，大约花了15分钟即可完成。sed一般比较适合少量文件的处理，若文件非常多且处理中无用信息很多，最好先用脚本程序(shell/python/perl)作预处理。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot;&gt; &lt;/script&gt;&lt;p&gt;最近处理大批量的html视
    
    </summary>
    
      <category term="技术" scheme="http://zenvv.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
</feed>
